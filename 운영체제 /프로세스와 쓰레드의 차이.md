# **📌** 프로세스와 쓰레드의 차이점

# 1. 프로세스 (Process)

![process](https://github.com/princenim/TIL/assets/59499600/d75014ee-4309-4cb3-a5c4-6b6d4647b6b0)

먼저 **프로그램**이란 파일이 저장 장치에 저장되어 있지만 메모리에는 올라가 있지 않는 정적인 상태의 파일을 말한다. **운영체제로부터 메모리를 할당받아 실행중에 있는 프로그램을 프로세스** 라고 한다.

프로세스마다 최소 1개 이상의  쓰레드를 갖는다. 각 프로세스는 별도의 주소 공간에서 실행되며 다른 프로세스의 자원에 접근할 수 없다. 다른 프로세스의 자원에 접근하려면 프로세스간 통신(IPC, LPC)을 사용하면 되는데 이는 RAM과 CPU 사이의 캐시 메모리까지 초기화되기 때문에 자원 부담이 크다.

CPU는 한번에 한가지 명령밖에 처리하지 못하는데 동시에 여러 프로세스를 실행하는 것이 아니라 빠르게 번갈아가면서 프로세스를 실행한다.

각각 독립된 메모리 영역(Code, Data, Stack, Heap)을 할당받는다.

- `Code area` : 프로그래머가 작성한 프로그램이 함수들의 코드가 CPU가 해석 가능한 기계어로 저장되어 있다.
- `Data area`: 코드가 실행되면서 사용한 환경이나 파일들의 각족 데이터가 모여있는 영역을 말한다.
- `Stack area` : 호출한 함수가 종료되면 되돌아올 메모리의 주소나 지역변수들이 모여있는 영역이다.
- `Heap area`: 생성자, 인스턴스와 같은 동적으로 할당되는 데이터가 있는 영역을 말한다.

# 2. 쓰레드(Thread)

**프로세스 안에서 실행되는 흐름 단위**를 말한다.

![thread](https://github.com/princenim/TIL/assets/59499600/d7af566d-d351-472c-9c91-77f2be419fab)

- 쓰레드는 하나의 프로세스 내에서 필요한 `Stack`만 할당받는다. `Code area`, `Data area`,`Heap are` 영역은 **프로세스 내 모든 쓰레드가 공유한다.**  즉 다시 말해 각각의 쓰레드는 자신의 stack 영역을 보유하며 나머지 영역을 공유한다. 따라서 병목현상, 데드락 등의 동기화 문제가 발생할 수 있다. 따라서 하나의 쓰레드의 문제가 생기면 해당 프로세스에 영향을 준다.

# 3. 멀티쓰레드와 멀티프로세스

## 3.1 멀티 프로세스

**여러 개의 CPU를 사용해 여러 프로세스를 동시에 수행하는것을 의미한다.** 예를들어 코딩할때 슬랙도 사용하고, 유투브도 켜놓고, 인텔리제이도 사용하는 것을 말한다.

여러 개의 프로세스 중 하나의 프로세스가 문제가 발생하면 해당 프로세스만 죽고 , 다른 프로세스에 영향을 주지 않아 안정성이 높다. 하지만 작업량이 많을 때 `Context Switching` 과정에서 캐쉬 메모리 초기화 등 무거운 작업이 진행되고 성능 저하가 발생할 수 있다.

### **Context Switching (문맥 교환)**

컴퓨터에서 동시에 처리할 수 있는 최대 작업 수는 CPU의 core 수와 같다. 따라서 CPU의 코어 수보다 더 많은 쓰레드가 실행되면 각 코어가 정해진 시간동안 여러작업을 번걸아가면서 수행해야한다.

멀티 프로세스 환경에서 CPU가 하나의 프로세스를 실행하고 있는 상태에서 인터럽트 요청에 의해 다른 프로세스를 실행해야할 때, **기존의 프로세스 상태를 저장하고 CPU가 다음 프로세스를 수행하도록 새로운 프로세스 상태를 교체하는** 것을 **Context Switching 이라고한다.**

이 Context Switching 에 걸리는 시간이 커지면 커질수록 멀티 쓰레딩의 효율은 저하된다.

## 3.2 멀티 쓰레드(Multi Thread)

**하나의 프로세스 안에서 둘 이상의 스레드가 동시에 작업을 수행하는 것을 말한다.**

프로세스 내의 `stack` 영역을 제외한 모든 메모리를 공유하기 때문에 통신의 부담이 적어 응답 시간이 빠르다 . 하지만 쓰레드하나가 프로세스 내 자원을 망친다면 모든 프로세스가 종료될 수 있다. 자원을 공유하기 때문에 `동기화(Synchronization)` 문제가 발생할 수 있다.

### 동기화 (Synchronization)

동기화란 멀티 쓰레드 환경에서 하나의 자원에 여러개의 쓰레드가 동시에 접근해서 자원을 변경하려고 할때 데이터의 정합성과 같은 문제가 발생할 수 있다.

## 3.3 멀티 프로세스로 할수 있는 작업을 멀티쓰레드로 하는 이유?

멀티 프로세스로 실행되는 작업을 멀티쓰레드로 실행할 경우, 프로세스를 생성하고 자원을 할당시키는 시스템 콜이 줄어들어 자원을 효율적으로 관리할 수 있다. 또한 쓰레드간 통신 비용이 적어 통신 부담이 줄어든다.

하지만 무조건 멀티쓰레드가 좋은 건 아니다. 쓰레드 간의 자원 공유로 인해 전역 변수의 경우 동기화문제가 발생하므로 개발 시 주의가 필요하다.

# 4. 동시성과 병렬성

<img width="416" alt="concurrency" src="https://github.com/princenim/TIL/assets/59499600/74da22b7-3411-4970-9230-52c78e08ede0">

동시성과 병렬성은 비슷해보이지만 다른 개념이다.

## 4.1 동시성(Concurrency)

**동시성은 하나의 코어에서 여러개의 작업이 동시에 실행되고 있는 것처럼 보이는 것**을 말한다.
싱글 코어에서 멀티쓰레드를 동작시키기 위한 방식이다. 여러 개의 쓰레드를 번갈아 가면서 실행되는 방식이다.
동시성은 싱글코어, 멀티코어에서 모두 구현가능하다.

## 4.2 병렬성(Parallelism)

실제로 **물리적으로 동시에 정확히 실행되는 것을 말한다.** 멀티 코어에서 멀티 쓰레드를 동작시키는 방식이다.
병렬성은 멀티 코어에서만 구현가능하다.