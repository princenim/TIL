# π“Β Mybatis κ°λ…κ³Ό λ™μ‘μ›λ¦¬

λ¨Όμ € `mybatis`λ¥Ό μ•κΈ°μ „μ— `JDBC`λ¥Ό μ•μ•„λ³΄μ
# 1. JDBC
`JDBC(Java Database Connectivity)`λ” μλ°”μ—μ„ λ°μ΄ν„°λ² μ΄μ¤μ— μ ‘μ†ν•κ³  λ°μ΄ν„°λ¥Ό μ €μ¥ν•κ±°λ‚ μ—…λ°μ΄νΈν•λ” λ“±μ μ‘μ—…μ„ μν–‰ν•κΈ° μ„ν• `API`μ΄λ‹¤. μ΄ `API`λ” λ°μ΄ν„°λ² μ΄μ¤μ™€μ ν†µμ‹ μ„ `μ¶”μƒν™”`ν•μ—¬ μλ°” μ–΄ν”λ¦¬μΌ€μ΄μ…μ—μ„ λ°μ΄ν„°λ² μ΄μ¤μ— μ‰½κ² μ ‘κ·Όν•  μ μλ„λ΅ ν•λ‹¤. .

![jdbc1](https://github.com/princenim/TIL/assets/59499600/4681d94c-afef-45dd-a173-c67a53d232bc)

λ” μ‰½κ² λ§ν•λ©΄ μ„Έμƒμ—λ” μλ§μ€ DBκ°€ μκ³  λ¨λ“  DBμ— λ§μ¶° μ½”λ“λ¥Ό κµ¬ν„ν•κ² λλ©΄ DBμ— λ§μ¶°μ„ μ½”λ“λ¥Ό μμ •ν•΄μ•Όν•λ‹¤. ν•μ§€λ§ `JDBC`λ” λ¨λ“  μ§€μ›ν•λ” λ°μ΄ν„° λ² μ΄μ¤μ— λ€ν•΄ μΌκ΄€λ μΈν„°νμ΄μ¤λ¥Ό μ κ³µν•λ‹¤. λ”°λΌμ„ κ°λ°μλ” λ°μ΄ν„°λ² μ΄μ¤λ¥Ό λ³€κ²½ν•λ”λΌκ³  μ½”λ“λ¥Ό λ³€κ²½ν•μ§€ μ•κ³  λ™μΌν• `JDBC λ©”μ†λ“`λ¥Ό μ‚¬μ©ν•μ—¬ μ‘μ—…μ„ μν–‰ν•  μ μλ‹¤. λ”°λΌμ„ λ°μ΄ν„°λ² μ΄μ¤ νμ‚¬λ” λ°μ΄ν„°λ² μ΄μ¤μ—λ€ν• `JDBC λ“λΌμ΄λ²„`λ¥Ό μ κ³µν•κ³ , κ°λ°μλ” `JDBC λ“λΌμ΄λ²„` ν†µν•΄ λ°μ΄ν„°λ² μ΄μ¤μ™€μ μ—°κ²° λ° μΏΌλ¦¬μ‹¤ν–‰κ³Ό κ°™μ€ μ‘μ—…λ§ μ‹ κ²½μ“°λ©΄λλ‹¤.

## 1.1 JDBCμ νλ¦„

`JDBC`μ νλ¦„μ€ λ‹¤μκ³Ό κ°™λ‹¤.

![jdbc2](https://github.com/princenim/TIL/assets/59499600/c3aacf61-57d7-4d30-9386-29e859618193)

1.  `DriverManager`κ°€ `JDBCDriver`λ¥Ό λ΅λ”©ν•λ‹¤. μ΄ `Driver`λ” `JDBC`κ°€ μ κ³µν•λ” `μΈν„°νμ΄μ¤`λ΅ κ° DBλ§λ‹¤ `μΈν„°νμ΄μ¤λ¥Ό` κµ¬ν„ν•λ” ν΄λμ¤λ¥Ό μ κ³µν•λ‹¤. μλ¥Όλ“¤μ–΄ `Mysql`μ„ μ‚¬μ©ν•λ” κ²½μ° `Mysql`μ΄ μ κ³µν•λ” `JDBC λ“λΌμ΄λ²„`, `Oracle`μ΄λΌλ©΄ `Oracle`μ—μ„ μ κ³µν•λ” λ“λΌμ΄λ²„λ¥Ό μ‚¬μ©ν•΄μ•Όν•λ‹¤.
2. `DriverManager`κ°μ²΄λ¥Ό μ‚¬μ©ν•΄ `Connection` μΈμ¤ν„΄μ¤λ¥Ό μ–»λ”λ‹¤.
3. `Connection` μΈμ¤ν„΄μ¤λ¥Ό ν†µν•΄ `Statement`μ„ μ–»λ”λ‹¤.
4. `Statement`λ¥Ό ν†µν•΄ `ResultSet`μ„ μ–»λ”λ‹¤.

ν•μ§€λ§ μ΄ `JDBC`λ” 1κ°μ ν΄λμ¤μ— sql, db μ—°κ²°, μλ°”μ–Έμ–΄κ°€ λ¨λ‘ μ΅΄μ¬ν•κΈ° λ•λ¬Έμ— μ¬μ‚¬μ©μ„±μ΄ μΆ‹μ§€μ•λ‹¤. μ΄λ° λ‹¨μ μ„ ν•΄κ²°ν•κΈ° μ„ν•΄ `Mybatis`μ™€ κ°™μ€ ν”„λ μ„μ›ν¬λ¥Ό μ‚¬μ©ν•  μ μλ‹¤.

# 1. Mybatis

[mybatis β€“ λ§μ΄λ°”ν‹°μ¤ 3 | μ‹μ‘ν•κΈ°](https://mybatis.org/mybatis-3/ko/getting-started.html)

`mybatis`λ” `RDB`λ¥Ό λ”μ± νΈν•κ² μ΄μ©ν•  μμλ„λ΅ κ°λ°λ `SQL Mapper`μ΄λ‹¤. μλ°” κ°μ²΄μ™€ sql μΏΌλ¦¬λ¥Ό λ§¤ν•‘ν•μ—¬ λ°μ΄ν„°λ² μ΄μ¤μ™€μ μƒνΈμ‘μ©μ„ νΈλ¦¬ν•κ² λ„μ™€μ¤€λ‹¤. `myabtis`λ¥Ό μ‚¬μ©ν•λ©΄ λ³„λ„μ `xml νμΌ`μ— μΏΌλ¦¬λ¥Ό μ‚¬μ©ν•λ©°, μ‘μ„±λ `sql μΏΌλ¦¬`λ” `mybatis`μ—μ„ μ κ³µν•λ” `Mapper μΈν„°νμ΄μ¤`λ¥Ό ν†µν•΄ μλ°” μ½”λ“μ—μ„ νΈμ¶ κ°€λ¥ν•λ‹¤.

### ORMκ³Ό SQL Mapperμ μ°¨μ΄μ 

`ORM`μ€ κ°μ²΄μ™€ λ°μ΄ν„°λ² μ΄μ¤ κ°„μ λ§¤ν•‘μ„ λ‹΄λ‹Ήν•λ‹¤. `ORM`μ€ λ°μ΄ν„°λ² μ΄μ¤μ ν…μ΄λΈ”μ„ κ°μ²΄λ΅ λ§¤ν•‘ν•κ³ , sql μΏΌλ¦¬ λ€μ‹  κ°μ²΄ μ§€ν–¥μ μΈ λ°©μ‹μΌλ΅ λ°μ΄ν„°λ¥Ό μ΅°μ‘ν•λ‹¤. μ£Όλ΅ JPAκ°€ λ€ν‘μ μΈ ORM ν”„λ μ„μ›ν¬μ΄λ‹¤.

`SQL Mapper`λ” `SQLμΏΌλ¦¬`μ™€ λ°μ΄ν„° λ² μ΄μ¤ κ°„μ λ§¤ν•‘μ„ λ‹΄λ‹Ήν•`λ‹¤. SQL Mapper`λ” κ°λ°μκ°€ μ§μ ‘ μΏΌλ¦¬λ¥Ό μ‘μ„±ν•κ³ , μ΄λ¥Ό λ°μ΄ν„° λ² μ΄μ¤μ™€ μ—°κ²°ν• κ²°κ³Όλ¥Ό λ§¤ν•‘ν•λ‹¤. λ€ν‘μ μΌλ΅ `mybatis`κ°€ μλ‹¤.

### Mybatis νΉμ§•

- sql λ¬Έκ³Ό μλ°” μ½”λ“κ°€ λ¶„λ¦¬λμ–΄ μμ–΄ μ‰½κ² μ μ§€λ³΄μκ°€ κ°€λ¥ν•λ‹¤.
- JDBCμ λ¨λ“  κΈ°λ¥μ„ Mybatisκ°€ λ€λ¶€λ¶„ μ κ³µν•λ‹¤.

## 2.1 Mybatis λ™μ‘μ›λ¦¬

![mybatis3](https://github.com/princenim/TIL/assets/59499600/c3490bcc-75e0-45c4-a9ab-46ed17ba3cd3)

1. μ–΄ν”λ¦¬μΌ€μ΄μ… μ‹μ‘μ‹ `SqlSessionFactoryBuilder`κ°€ μ„¤μ •νμΌμ„ μ°Έκ³ ν•΄ `SqlSessionFactory`λ¥Ό μƒμ„±ν•λ‹¤. μ„¤μ •νμΌμ—λ” `mybatis`μ κµ¬μ„±μ •λ³΄λ¥Ό λ‹΄κ³ μλ‹¤.
2. `SqlSessionFactory`λ” λ§¤ μ”μ²­λ§λ‹¤ `SqlSessio` κ°μ²΄λ¥Ό μƒμ„±ν•λ‹¤.
3. `SqlSession`μ„ μ‚¬μ©ν•΄ λ§¤νΌ νμΌμ— μ •μλ `sql μΏΌλ¦¬`λ¥Ό νΈμ¶ν•μ—¬ μ‹¤ν–‰ν•λ‹¤.
4. μΏΌλ¦¬μ μ‹¤ν–‰κ²°κ³Όλ” μλ°” κ°μ²΄λ΅ λ§¤ν•‘λμ–΄ `SqlSession`λ¥Ό ν†µν•΄ λ°ν™λλ‹¤.
5. λ°μ΄ν„°λ² μ΄μ¤μ™€μ μƒνΈμ‘μ©μ΄ μ™„λ£λλ©΄ `SqlSession` μ„ λ‹«μ•„μ•Όν•λ‹¤. κ·Έλ¦¬κ³  μ»¤λ°‹λμ§€ μ•μ€ νΈλμ­μ…μ„ μ‚¬μ©ν•  κ²½μ° λ…μ‹μ μΌλ΅ λ΅¤λ°± μ΄λ‚ μ»¤λ°‹μ„ μν–‰ν•΄μ•Όν•λ‹¤.

κ·Έλ¦Όμ—μ„`(1)~(3)`κΉμ§€λ” μ–΄ν”λ¦¬μΌ€μ΄μ… μ‹μ‘μ‹ ν•λ² μν–‰λλ©°, `(4)~(10)`κΉμ§€λ” λ§¤ μ”μ²­λ§λ‹¤ μν–‰λλ‹¤.

## 2.2 Mybatis μ„¤μ •

1. `gradle`λ΅ μμ΅΄μ„± μ„¤μ •

```groovy
    implementation 'org.mybatis.spring.boot:mybatis-spring-boot-starter:3.0.3'
```

2. `mybatis` μ„¤μ •ν•κΈ° : `myabtis` μ„¤μ •ν•λ” λ°©λ²•μ€ λ‘ κ°€μ§€μ΄λ‹¤.
   1. μλ°” μ½”λ“λ΅ μ‘μ„± : `mybatis`μ„¤μ •μ„ xmlμ΄ μ•„λ‹ μ„¤μ •μ„ μ κ³µν•λ” Configuration ν΄λμ¤λ¥Ό μ‚¬μ©ν•  μ μλ‹¤.
   2. `mybatis-confing.xml` μ‘μ„±:  `Mybatis-confing.xml` λ” `mybatis` μ‹¤ν–‰ μ‹ ν•„μ”ν• μ„¤μ • μ •λ³΄λ¥Ό κ°–κ³  μλ” νμΌμ΄λ©° ν”„λ΅μ νΈμ λ¦¬μ†μ¤ ν΄λ”μ— μ„μΉν•λ‹¤.

```xml
<?xml version="1.0" encoding="UTF-8" ?>
<!--mybatis μ„¤μ •νμΌ -->
<!DOCTYPE configuration PUBLIC "-//mybatis.org//DTD Config 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-config.dtd">
<configuration>
    <mappers>
        <!--MyBatis λ§¤νΌ νμΌμ„ μ΄ μ„¤μ • νμΌμ— λ“±λ΅ν•λ” κ²ƒ.ν•΄λ‹Ή λ§¤νΌνμΌμ—λ” μΏΌλ¦¬λ¥Ό μ •μν•λ‹¤. -->
        <mapper resource="UserMapper.xml"/>
    </mappers>
</configuration>
```


3. μ„¤μ • νμΌ μ„μΉ μ§€μ • : `mybatis-confing.xml` νμΌμ„ μ‚¬μ©ν•λ ¤λ©΄ ν•΄λ‹Ή νμΌμ μ„μΉλ¥Ό μ§€μ •ν•΄μ¤μ•Όν•λ‹¤. `application.properties`μ— μ„μΉλ¥Ό μ§€μ •ν•λ‹¤.

```xml
# Mapper.xml νμΌ μ„μΉ μ§€μ • 
mybatis.mapper-locations=classpath:mapper/**/*.xml
```

4. `sql mapper` μ‘μ„±ν•κΈ° :  μ΄ λ°©λ²•μ—λ” 2κ°€μ§€ λ°©λ²•μ΄ μλ‹¤.
   1.  μΈν„°νμ΄μ¤ κΈ°λ° λ§¤νΌ μ‘μ„± : sql μΏΌλ¦¬μ™€ κ²°κ³Ό λ§¤ν•‘ μ„¤μ •μ„ μλ°” μΈν„°νμ΄μ¤μ— μ‘μ„±ν•λ‹¤. `mybatis` μ–΄λ…Έν…μ΄μ…μ„ μ‚¬μ©ν•΄ sql μΏΌλ¦¬λ¥Ό μ •μν•λ‹¤. 
   2.  `XML` κΈ°λ° λ§¤νΌ μ‘μ„± : `XML` κΈ°λ° λ§¤νΌλ” sql μΏΌλ¦¬μ™€ λ§¤ν•‘ μ„¤μ •μ„ xml νμΌμ— μ‘μ„±ν•λ‹¤. `λ§¤νΌλ…Mapper.xml` κ³Ό κ°™μ€ ν•μ‹μΌλ΅ μ‘μ„±ν•λ‹¤. κ·Έλ¦¬κ³  λ³΄ν†µ `src/main/resources/mapper` λ””λ ‰ν† λ¦¬μ— μ„μΉμ‹ν‚¨λ‹¤.

```xml
<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.kboticketing.kboticketing.dao.UserMapper">
    <insert id="insertUser" parameterType="com.kboticketing.kboticketing.domain.User">
        INSERT INTO users (name, `email`, password, role, created_at)
        VALUES (#{name}, #{email}, #{password}, #{role}, #{createdAt})
    </insert>
</mapper>

```
 