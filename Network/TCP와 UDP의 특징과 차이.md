# **📌**  TCP 와 UDP의 특징과 차이

# 1. TCP(Transmisson Control Protocol)

`TCP`란 인터넷상에서 데이터를 메세지의 형태로 보내기 위해 `IP`와 함께 사용하는 프로토콜이다. **신뢰성있는 어플리케이션 간의 데이터 전송을 하기위한 연결형 프로토콜이다.** 따라서 메신저에서 친구와 채팅을 하거나 이메일을 보내거나 할때 이 프로토콜을 사용한다.

`TCP`는 `3 way handshaking` 과정을 통해 연결하고 `4 way handshaking`을 통해 연결을 해제한다. 따라서 높은 신뢰성을 보장한다.

먼저 연결방식을 알기전에 `세그먼트`를 아는 것이 좋다.

### 세그먼트(segment)

![tcp segment](https://github.com/princenim/TIL/assets/59499600/75d1b503-ae26-4cde-a2f1-0d0723587b4c)

위의 이미지는 `세드먼트`이다. `TCP`로 데이터를 전송할때 붙이는 헤더를 `TCP 헤더`라고 하며 , `TCP 헤더`가 붙은 데이터를 `세그먼트`라고 한다. 즉, `TCP 세드먼트` = `TCP 헤더` + `데이터` 이다.

그리고 그림의 코드 비트(6비트)를 확인할 수 있는데 이는 위의 flag정보이다. 코드 비트는 각 비트별로 역할이 존재하며 초기값은 0 이고 비트가 활성화되면 1이 된다.

## 1.1. TCP의 연결방식

1. `3 way handshake` 방식으로 연결을 맺고,
2.   데이터를 전송
3.  `4 way handshake` 를 통해 연결을 끊는다.

<img width="522" alt="handshake" src="https://github.com/princenim/TIL/assets/59499600/0fdf26e1-a23c-47de-a597-565355a4edab">

### 연결 맺기 - 3 way handshake

1. `client`가 `server`에세 `syn(요청)`를 보낸다.
2. `server`은 `Listen` 상태에서 `syn`가 들어온 것을 확인하고 `syn_received` 상태로 바꾸고 `clinet`에게 `syn(요청)`+`ack(응답)`을 보낸다.
3. `client`는 `syn+ack` 패킷을 받고 상태를 확인한 후 서버에게 `ack(응답)`를 보내고 연결이 된다.

즉 연결하고 싶어!, 연결해도괜찮아~, 확인했어! 이렇게 3번의 신호를 주고받는다고 해서 `3 way handshake`이다. 이 단계가 성공적으로 완료되면 데이터 전송을 할 수 있다.

### 연결 끊기 - 4 way handshake

1. `client`가 연결을 종료하겠다는 `fin(종료 요청)` 플래그를 전송한다. 그리고 `FIN-WAIT-1` 상태로 변한다.
2. `fin` 플래그를 받은 `server`는 확인메세지인 `ack`를 `client`에게 보낸다. 그 후 `close-wait` 상태로 변한다. 그리고 `client`도 마찬가지로 받은후에 `server`에게 종료될 준비가 됐다는 `fin`을 받기위해 `fin-wait-2` 상태가 된다.
3. `server`는 `close`준비가 된후 다시 `client`에게 `fin`플래그를 전송한다.
4. `fin`을 받은 클라이언트는 `time-wait` 상태로 바꾸고 `server`에게 `ack`를 보내어 연결 종료를 확정짓는다.

### 데이터 전송

`3 way handshake`로 연결이 확립되면 데이터 전송이 가능하다.

`TCP 프로토콜`에서는 실제 데이터를 보낼때나 상대방이 받을 때는 `TCP 헤더`의 `일련번호(sequence number)` 과 `확인 응답번호(Acknowldgement number)`를 사용한다.

- `일련번호(sequence number)`  : 송신 측에서 수신 측에 ‘이 데이터가 몇번이지 알려주는 역할을 한다.’ 즉, 전송된 데이터레 일련번호를 부여하면 수신자는 원래 데이터의 몇 번째 데이터를 받았는지 알 수 있다.
- `확인 응답번호(Acknowldgement number)`: 수신 측이 몇번째 데이터를 수신했는지 송신 측에 알려주는 역할을 한다. 그래서 이 번호는 다음 번호의 데이터를 요청하는 데도 사용된다.

![tcp ](https://github.com/princenim/TIL/assets/59499600/cadf0c8b-ede8-47d3-8510-b9004aa7f6fa)

1. 컴퓨터 1은 컴퓨터 2로 200바이트의 데이터를 전송한다.
2. 컴퓨터 2는 200바이트를 수신하고 다음에 수신하고자하는 데이터 번호를 확인해 응답 번호에 넣는다. 다음에 수신하고자하는 데이터는 3001 + 200 = 3201 이므로 3201부터 보내달라고 요청한다.
3. 컴퓨터 1은 3201번부터 200바이트의 데이터를 전송한다.
4. 컴퓨터 2는 200바이트를 수신하고 다음에 수신하고자 하는 데이터의 번호를 확인 응답 번호를 넣는다. 이때 번호는 3201  + 200 = 3401 이다. 즉 3401부터 보내달라고 요청한다.

이렇게 데이터가 전송이 완료될때까지 반복하며 데이터는 항상 올바르게 전달되는 것이 아니므로 일련번호와  확인응답번호를 사용해서 **데이터가 손상되거나 유실된 경우에 데이터를 재전송해야한다. 이를 재전송 제어**라고 한다.

### 윈도우 크기

위의 방법은 세그먼트를 하나를 보낼때마다 확인 응답을 한 번반환하는 통신이다. 즉 매번 확인응답을 기다려야하기때문에 효율이 낮다. 대신 세그먼트를 한번에 연속해서 보낸 후에 확인응답을 반환하면 효율이 더 높아진다.

이런 세그먼트를 일시적으로 보관하는 곳이 `버퍼(buffer)`라고하고, 이 버퍼때문에 연속으로 세그먼트를 보내도 수신 측은 대응할 수 있다. 하지만 너무 많이 보내면 보관하지 않고 넘어버리는데 이를 `오버플로우(overflow`) 라고 하며, 오버플로우가 발생하지 않도록 버퍼의 한계크기를 저장하는 곳이 `TCP 헤더`의 `윈도우 크기`이다.

윈도우 크기의 초기값은 `3 way handshake`을 할때 판단한다. 즉 서로의 한계값을 확인하고 후에 데이터 전송시에 이 윈도우 크기를 활용해 데이터를 전송하는 것이다.

![segment](https://github.com/princenim/TIL/assets/59499600/ec3fa839-3f9c-4ec3-a520-48dab9a2bb41)

### flag 정보

- `syn(Synchronize Sequence Number)`  :  연결 요청, sequence number을 랜덤으로 설정해 세션을 연결하는 데 사용한다. 즉 connection을 맺을 때 사용하는 flag이다.
- `ack(Acknowldgement)`  : 요청 확인 , 패킷을 받았다는 것을 의미하는 flag이다.
- `fin` : 종료 요청

### state 정보

- `LISTEN` : 포트가 열린 상태로 연결 요청 대기 중
- `SYN_RECEIVED` : syn 요청을 받고 상대방의 응답을 기다리는 중
- `ESTABLISHED`: 포트 연결 상태
- `TIME-WAIT`: Server로부터 FIN을 수신하더라도 일정시간(default: 240초)동안 세션을 남겨놓고 잉여 패킷을 기다리는 상태.  즉 연결은 종료되었지만 분실되었을지 모를 느린 세드먼트를 기다리는 상태
- `CLOSED` : 포트가 완전히 닫힌 상태

# 2. UDP (User Datagram Protocol)

`UDP`는 데이터를 데이터그램 단위로 처리하는 프로토콜이다. `**UDP`는 비연결형, 신뢰성 없는 프로토콜이다.** 따라서 연결을 설정하고 해제하는 과정이 존재하지 않아 신뢰성이 낮아 `TCP`보다 효율적이고 속도가 빠르다. 스트리밍 방식으로 전송하는 동영상 서비스와 같은 곳에서 사용된다. 동영상을 `TCP`통신으로 전송하면 수신을 확인하는데 너무 오래 걸리기때문에 동영상을 원활하게 볼수없기때문에 동영상 서비스는 UDP 통신을 사용한다.

## 2.1 UDP의 전송 방식

### UDP 데이터그램

![udp](https://github.com/princenim/TIL/assets/59499600/9f40bed7-ece7-480c-8485-5ce5d3a1ec3f)

이미지와 같이 `UDP 헤더`가 붙은 데이터를 `UDP 데이터그램`이라고 한다.  즉 `UDP데이터그램` = `UDP 헤더` + `데이터` 를 말한다.

- `출발지 포트 번호(source port)`
- `목적지 포트번호 (destination port)`
- `길이 (length)`
- `체크섬 (checksum)` : 전송된 데이터가 변형이되지 않았는지 확인하는 값이다. 전송하려는 세그먼트(데이터그램)의 값들을 이용해 체크섬을 만들어 세그먼트에 담아 전송하고, 세그먼트를 받은 수신측은 세그먼트의 값들을 이용해 다시 체크섬을 계산하고 저장된 체크섬값과 비교한다. 따라서 두 값이 다르면 전송 중 세그먼트의 내용이 변형되었음을 의미한다.

### 브로드캐스트(broadcast)

![datagram ](https://github.com/princenim/TIL/assets/59499600/291957ed-b470-4b09-b47d-6528224639f1)

`UDP`를 사용하면 랜에 있는 컴퓨터나 네트워크 장비에 데이터를 일괄로 보낼 수 있다. 이를 `브로드캐스트(broadcast)`라고 한다.

# 3. TCP와 UDP의 차이

| 프로토콜 종류 | TCP | UDP |
| --- | --- | --- |
| 연결방식  | 연결형 서비스 | 비연결형 서비스 |
| 전송 순서 | 전송순서 보장 | 전송 순서가 바뀔 수 있음.  |
| 수신 여부 확인 | 수신여부를 확인 | 수신여부를 확인하지 않음 |
| 통신 방식 | 1:1 통신 | 1:1, 1:N, N:N 통신 |
| 신뢰성 | 높다  | 낮다 |
| 속도 | 느리다 | 빠르다.  |