# ðŸ“ŒCORS(Cross Origin Resource Sharing)

# 1. Origin

ë¨¼ì € `CORS` ì„ ì•Œê¸°ì „ì— `Origin`ì„ ì•Œì•„ë³´ìž. `Origin`ì´ëž€ ì¶œì²˜ë¼ëŠ” ëœ»ìœ¼ë¡œ `URL`ì—ì„œ `í”„ë¡œí† ì½œ`, `ë„ë©”ì¸`, `í¬íŠ¸ë²ˆí˜¸`ë¥¼ í•©ì¹œ ë¶€ë¶„ì„ ì˜ë¯¸í•œë‹¤.

`https://hazel.com:80/posts/123456?data=789#abc` ì´ëŸ° URLì´ ì¡´ìž¬í•œë‹¤ë©´ `https://it-eldorado.com:80` ì´ ë¶€ë¶„ì´ `Origin`ì´ë‹¤.

# 2. SOP(Same Origin Policy)

`SOP`ëŠ” `ë™ì¼ ì¶œì²˜ ì •ì±…`ì´ë¼ëŠ” ëœ»ìœ¼ë¡œ ê°™ì€ ì¶œì²˜ì—ì„œ ë¡œë“œëœ ë¦¬ì†ŒìŠ¤ë§Œ ì ‘ê·¼í•  ìˆ˜ ìžˆë„ë¡ í•˜ëŠ” ì •ì±…ì´ë‹¤. ì‰½ê²Œ ë§í•˜ë©´ ë‚´ ì›¹ íŽ˜ì´ì§€ì—ì„œ ë‹¤ë¥¸ ì›¹íŽ˜ì´ì§€ì˜ ìŠ¤í¬ë¦½íŠ¸ë¥¼ ì‹¤í–‰ì‹œí‚¤ëŠ” ê²ƒì„ ë§‰ëŠ” ê²ƒì„ ë§í•œë‹¤. ë‚´ê°€ ë„¤ì´ë²„ ë¸”ë¡œê·¸ì— ê¸€ì„ ì¼ì„ ë•Œ ë‹¤ë¥¸ ì‚¬ì´íŠ¸ì— ìžˆëŠ” ìŠ¤í¬ë¦½íŠ¸ë¥¼ ì½ì§€ ëª»í•˜ê²Œ ë§‰ëŠ”ê²ƒì„ ë§í•œë‹¤. ì—¬ê¸°ì„œ ë¦¬ì†ŒìŠ¤(ìžì›)ì´ëž€ CSSë‚˜ ì´ë¯¸ì§€ì²˜ëŸ¼ ì •ì ì¸ ìžì›ì„ ë¦¬ì†ŒìŠ¤ë¼ê³  í‘œí˜„í•œë‹¤.

`SOP`ì˜ ì£¼ ëª©ì ì€ ë³´ì•ˆ ê°•í™”ì´ë‹¤. ê°™ì€ ì¶œì²˜ì˜ ë¦¬ì†ŒìŠ¤ë§Œ ìƒí˜¸ìž‘ìš©í•  ìˆ˜ ìžˆë„ë¡ í•¨ìœ¼ë¡œì¨ ì•…ì˜ì ì¸ ì‚¬ì´íŠ¸ì—ì„œ ì›¹ íŽ˜ì´ì§€ì˜ ìŠ¤í¬ë¦½íŠ¸ë¥¼ ì‹¤í–‰ì‹œì¼œ ì¡°ìž‘í•˜ê±°ë‚˜ ì‚¬ìš©ìž ì •ë³´ë¥¼ íƒˆì·¨í•˜ëŠ”ê²ƒì„ ë§‰ì•„ì¤€ë‹¤. `SOP`ë¥¼ ì™„í™”í•˜ì—¬ ë‹¤ë¥¸ ì¶œì²˜ê°„ì˜ ë¦¬ì†ŒìŠ¤ì— ì ‘ê·¼ ê°€ëŠ¥í•˜ê²Œ í•´ì£¼ëŠ” ì •ì±…ì´ `CORS`ì´ë‹¤.

# 3. CORS(Cross Origin Resource Sharing)

`CORS`ëŠ” `Cross Origin Resource Sharing`ì˜ ì•½ìžë¡œ `êµì°¨ ì¶œì²˜ ë¦¬ì†ŒìŠ¤ ê³µìœ `ë¥¼ ë§í•œë‹¤. ì¦‰, **ë‹¤ë¥¸ ì¶œì²˜ì˜ ë¦¬ì†ŒìŠ¤ì— ì ‘ê·¼í•˜ê¸° ìœ„í•œ ë³´ì•ˆ ë©”ì»¤ë‹ˆì¦˜ì„ ë§í•œë‹¤.**

`SOP`ë¡œ ì¸í•´ ë‹¤ë¥¸ ì¶œì²˜ì˜ ìžì›ì„ ì‚¬ìš©í•  ìˆ˜ ì—†ëŠ”ë° ì´ëŠ” ì•…ì˜ì ì¸ ìš”ì²­ì„ ë§‰ì„ ìˆ˜ ìžˆë‹¤ëŠ” ìž¥ì ì´ ìžˆì§€ë§Œ ìœ íš¨í•œ ìš”ì²­ ë˜í•œ ë§‰ì•„ë²„ë¦°ë‹¤ëŠ” ë‹¨ì ì´ìžˆë‹¤. ì›¹ í™˜ê²½ì€ ê°œë°©ì ì´ê³  ì„œë¡œ ë‹¤ë¥¸ ì¶œì²˜ì—ì„œ ë¦¬ì†ŒìŠ¤ë¥¼ ê°€ì ¸ì™€ì„œ ì‚¬ìš©í•˜ëŠ” í–‰ìœ„ìžì²´ë¥¼ ë§‰ì•„ë²„ë¦¬ë©´ ì–´í”Œë¦¬ì¼€ì´ì…˜ì´ ë™ìž‘í•˜ê¸° íž˜ë“¤ë‹¤. ë”°ë¼ì„œ ì¶œì²˜ê°€ ë‹¤ë¥¸ ë¦¬ì†ŒìŠ¤(ìžì›)ë¥¼ ì‚¬ìš©í•  ìˆ˜ ìžˆë„ë¡ í•˜ëŠ” ëª‡ê°€ì§€ ì˜ˆì™¸ ì¡°í•­ì´ ìžˆëŠ”ë° ê·¸ì¤‘ í•˜ë‚˜ê°€ ë°”ë¡œ `CORS` ì •ì±…ì„ ì§€í‚¨ ë¦¬ì†ŒìŠ¤ ìš”ì²­ì´ë‹¤.

ì„œë²„ì¸¡ì—ì„œ HTTP ì‘ë‹µ í—¤ë”ì¸  `Access-Control-Allow-Credentials` ì— í—ˆìš©í•˜ëŠ” ì¶œì²˜ë¥¼ ë„£ì–´ì„œ ìš”ì²­ì„ í—ˆìš©í•˜ëŠ”ì§€ì˜ ì—¬ë¶€ë¥¼ ì•Œë ¤ì£¼ê³ ,  ì‘ë‹µì„ ë°›ì€ ë¸Œë¼ìš°ì €ëŠ” ìžì‹ ì´ ë³´ëƒˆë˜ ìš”ì²­ì˜ `Origin`ê³¼ ì„œë²„ ì‘ë‹µì˜ `Access-Control-Allow-Origin` ê°’ì´ ì¼ì¹˜í•˜ëŠ”ì§€ í™•ì¸í•˜ê³  ì¼ì¹˜í•˜ë©´ ìœ íš¨í•œ ìš”ì²­ì´ë¼ê³  íŒë‹¨í•´ ë°›ì•„ì˜¨ ë¦¬ì†ŒìŠ¤ë¥¼ ì‚¬ìš©í•œë‹¤.

## 3.1 CORSì˜ ë™ìž‘ë°©ì‹

`CORS`ì˜ ë™ìž‘ë°©ì‹ì€ í¬ê²Œ 3ê°€ì§€ë¡œ ë‚˜ëˆŒ ìˆ˜ ìžˆë‹¤.

### 1. ë‹¨ìˆœìš”ì²­ (Simple Request)

![simple request](https://github.com/princenim/TIL/assets/59499600/248775ef-f18a-425e-9232-5af3928dd7f8)

ìš”ì²­ê³¼ ì‘ë‹µì„ í•œë²ˆ ì£¼ê³ ë°›ëŠ” ê²ƒì„ ì˜ë¯¸í•œë‹¤. í•˜ì§€ë§Œ í•œë²ˆ ì¼ì–´ë‚˜ëŠ” ë§Œí¼ ì•ˆì •ì„±ì„ ë³´ìž¥í• ìˆ˜ìžˆë„ë¡ ì¡°ê±´ì´ ê¹Œë‹¤ë¡­ë‹¤.

- HTTP ë©”ì†Œë“œê°€ `GET`,`HEAD`, `POST`ì¤‘ í•˜ë‚˜ì—¬ì•¼í•œë‹¤.
- `User Agent`ê°€ ìžë™ìœ¼ë¡œ ì„¤ì •í•œ í—¤ë”ë¥¼ ì œì™¸í•˜ë©´ `Accept`, `Accept-Language`, `Content-Language` ,`Content-Type`, `DPR`, `Downlink(en-US)`, `Viewport-Width`, `Width` ë§Œ ì‚¬ìš©í•  ìˆ˜ ìžˆë‹¤.
- `Content-Type` í—¤ë”ì—ì„œëŠ” `application/x-www-form-urlencode` , `mulipart/form-data`, `text/plain` ì˜ ê°’ë§Œ ì„¤ì •í•  ìˆ˜ ìžˆë‹¤.

`ì‚¬ì „ ìš”ì²­(Preflight Request)` ë‹¨ê³„ë¥¼ ê±°ì¹˜ì§€ ì•Šê³  ë°”ë¡œ ì„œë²„ì— ìš”ì²­ì„ ì „ì†¡í•  ìˆ˜ ìžˆì–´ íš¨ìœ¨ì ì¸ í†µì‹ ì´ê°€ëŠ¥í•˜ë‹¤. ì„œë²„ëŠ” ì‘ë‹µ í—¤ë”ì— í—ˆìš©ë˜ëŠ” ë¸Œë¼ìš°ì €ì˜ ì£¼ì†Œë¥¼ ëª…ì‹œí•´ì„œ ì‘ë‹µí•œë‹¤. ê·¸ë¦¬ê³  ë¸Œë¼ìš°ì €ëŠ” í—ˆìš©ëœ ì¶œì²˜ì˜ ìš”ì²­ì— ëŒ€í•´ì„œë§Œ ì›¹ íŽ˜ì´ì§€ì˜ ê²°ê³¼ë¥¼ í‘œì‹œí•œë‹¤.

```bash
HTTP/1.1 200 OK
Content-Type: application/json
Access-Control-Allow-Origin: http://example-origin.com //í—ˆìš©í•˜ëŠ” URL
```

### 2. ì‚¬ì „ ìš”ì²­(Preflight Request)

![preflight](https://github.com/princenim/TIL/assets/59499600/3c7f63fe-6176-4179-a385-1df2024cd125)

ì‚¬ì „ ìš”ì²­ì€ ë³¸ ìš”ì²­ì„ ë³´ë‚´ê¸°ì „ì— ì‚¬ì „ ìš”ì²­ì„ ë³´ë‚´ì„œ ì„œë²„ê°€ ì´ì— ëŒ€í•´ ì‘ë‹µì´ ê°€ëŠ¥í•œì§€ í™•ì¸í•˜ëŠ” ë°©ë²•ì´ë‹¤.ì•ˆì „í•œ ìš”ì²­ìž„ì„ í™•ì¸í•˜ë©´ ê·¸ë•Œì„œì•¼ ì‹¤ì œìš”ì²­ì„ ë³´ë‚´ë¯€ë¡œ ì´ 2ë²ˆì˜ ìš”ì²­ì„ ì „ì†¡í•œë‹¤.

ì‚¬ì „ ìš”ì²­ì€ í•­ìƒ `OPTIONS ë©”ì†Œë“œ`ë¥¼ ì‚¬ìš©í•œë‹¤. ê·¸ë¦¬ê³  í—¤ë”ì—ëŠ” `Origin`, `Access-Control-Request-Method`, `Access-Control-Request-Headers` ë“±ì´ í¬í•¨ëœë‹¤. ì„œë²„ëŠ” ì‚¬ì „ìš”ì²­ì„ ë°›ì•„ì„œ ì‹¤ì œ ìš”ì²­ì„ í—ˆìš©í• ì§€ ì—¬ë¶€ë¥¼ íŒë‹¨í•˜ê³  ì´ì— ëŒ€í•œ ì‘ë‹µìœ¼ë¡œ  `Access-Control-Allow-Origin`, `Access-Control-Allow-Methods`, `Access-Control-Allow-Headers` ë“±ì„ í¬í•¨í•˜ëŠ” í—¤ë”ë¥¼ ë°˜í™˜í•œë‹¤.

ì‘ë‹µí•˜ëŠ” í—¤ë”ëŠ” ë‹¤ìŒê³¼ ê°™ë‹¤.

- `Access-Control-Allow-Origin`**:** ìš”ì²­ì´ í—ˆìš©ë˜ëŠ” ì¶œì²˜ì˜ ëª©ë¡ì„ ë‚˜íƒ€ë‚´ëŠ” í—¤ë”.
- `Access-Control-Allow-Methods`**:** í—ˆìš©ë˜ëŠ” HTTP ë©”ì„œë“œì˜ ëª©ë¡ì„ ë‚˜íƒ€ë‚´ëŠ” í—¤ë”.
- `Access-Control-Allow-Headers`**:** í—ˆìš©ë˜ëŠ” í—¤ë”ì˜ ëª©ë¡ì„ ë‚˜íƒ€ë‚´ëŠ” í—¤ë”.
- `Access-Control-Allow-Credentials`**:** ì¸ì¦ ì •ë³´ë¥¼ ìš”ì²­ì— í¬í•¨í•  ìˆ˜ ìžˆëŠ”ì§€ ì—¬ë¶€ë¥¼ ë‚˜íƒ€ë‚´ëŠ” í—¤ë”.
- `Access-Control-Max-Age`**:** ì‚¬ì „ ìš”ì²­ì˜ ê²°ê³¼ë¥¼ ìºì‹±í•  ìˆ˜ ìžˆëŠ” ì‹œê°„(ì´ˆ)ì„ ë‚˜íƒ€ë‚´ëŠ” í—¤ë”.

```bash
HTTP/1.1 200 OK
Access-Control-Allow-Origin: http://example-origin.com
Access-Control-Allow-Methods: GET, POST, OPTIONS
Access-Control-Allow-Headers: Content-Type
Access-Control-Max-Age: 86400
```

### 3. ì¸ì¦ ì •ë³´ë¥¼ í¬í•¨í•œ ìš”ì²­(Credential Request)

![credential](https://github.com/princenim/TIL/assets/59499600/eb312c36-70a8-4e49-a83d-1b3803a76018)

ì´ ìš”ì²­ì€ ì¸ì¦ì •ë³´(credential)ì„ í•¨ê»˜ ë³´ë‚´ëŠ” ìš”ì²­ì„ ë§í•œë‹¤. ì¸ì¦ì •ë³´ì—ëŠ” `ì¿ í‚¤`ì™€ `HTTP ì¸ì¦ í—¤ë”`ë¥¼ ì˜ë¯¸í•œë‹¤.

ì´ ìš”ì²­ì„ ì‚¬ìš©í•˜ë ¤ë©´  ë³´ì•ˆìƒì˜ ì´ìœ ë¡œ ë¯¼ê°í•œ ì •ë³´ë¥¼ ë‹´ì€ ìš”ì²­ì„ ë³´ë‚¼ë•Œ ì¶”ê°€ì ì¸ ê·œì¹™ì„ ë”°ë¼ì•¼í•œë‹¤. ë°˜ë“œì‹œ ì„œë²„ì¸¡ì—ì„œ `Access-Control-Allow-Credentials` ë¥¼ `true`ë¡œ ì„¤ì •í•´ì•¼í•œë‹¤. `Access-Control-Allow-Origin` ì— `*` ë¥¼ ì‚¬ìš©í•˜ì§€ ì•Šê³  url ë¥¼ ì •í™•ížˆ ì„¤ì •í•´ì•¼í•œë‹¤. ì´ë ‡ê²Œ í•˜ë©´ ë¸Œë¼ìš°ì €ëŠ” ì‹¤ì œ ìš”ì²­ì„ ë³´ë‚¼ë•Œ ìžê²© ì¦ëª…ì„ ë³´ë‚¼ ìˆ˜ ìžˆë‹¤.

```bash
#ì‘ë‹µ
HTTP/1.1 200 OK
Content-Type: application/json
Access-Control-Allow-Origin: http://example-origin.com
Access-Control-Allow-Credentials: true
```

HTTP ì¸ì¦ í—¤ë”ëŠ”  `Authorization` í—¤ë”ë¥¼ ì‚¬ìš©í•˜ëŠ” ê²½ìš°ë¥¼ ë§í•œë‹¤. `Authorization` í—¤ë”ëŠ” ì¼ë°˜ì ìœ¼ë¡œ HTTP ê¸°ë°˜ì˜ ì¸ì¦ ë°©ì‹(Basic, Bearer ë“±)ì— ì‚¬ìš©ëœë‹¤.

```bash
#ìš”ì²­ 
GET /example HTTP/1.1
Host: example.com
Authorization: Basic base64encoded(username:password)
```

## 3.1 CORS ì—ëŸ¬

`CORS ì—ëŸ¬`ëŠ” ë¸Œë¼ìš°ì €ì—ì„œ ë°œìƒí•˜ëŠ” ì˜¤ë¥˜ë¡œ `CORS` ì •ì±… ìœ„ë°˜ì‹œì— ë‚˜íƒ€ë‚œë‹¤. ì´ ì—ëŸ¬ëŠ” í”„ë¡ íŠ¸ì™€ ë°±ì—”ë“œë¡œ ë‚˜ëˆ„ì–´ ê°œë°œí•  ê²½ìš° í”ížˆ ë‚˜íƒ€ë‚œë‹¤.
ì°¸ê³ ë¡œ `localhost`ëŠ” í˜„ìž¬ ì‚¬ìš©ì¤‘ì¸ ì»´í“¨í„°ë¥¼ ê°€ë¦¬í‚¨ë‹¤. íŠ¹ë³„í•œ ipë¡œ `127.0.0.1`ê³¼ ë™ì¼í•œ ì—­í• ì„ í•œë‹¤. ì˜ˆë¥¼ ë“¤ì–´ ë¸Œë¼ìš°ì €ì—ì„œ `http://localhost` ë¥¼ ì›¹ ë¸Œë¼ìš°ì €ì—ì„œ ì—´ë©´ í˜„ìž¬ ì»´í“¨í„°ì— ì„¤ì¹˜ëœ ì›¹ ì„œë²„ì— ì ‘ì†í•˜ê²Œ ëœë‹¤. ë”°ë¼ì„œ ë‚´ ë¡œì»¬ì—ì„œ ê°œë°œí• ë•ŒëŠ” CORS ì—ëŸ¬ê°€ ë‚  ìˆ˜ ì—†ë‹¤. `localhost` ë˜ëŠ” `127.0.0.1`ê°€ ë™ì¼ ì¶œì²˜ë¡œ ê°„ì£¼ë˜ê¸°ë•Œë¬¸ì´ë‹¤. 

Springì—ì„œ  `CORS` ì—ëŸ¬ë¥¼ í•´ê²°í•  ìˆ˜ ìžˆëŠ” ë°©ë²•ì€ ë‹¤ìŒê³¼ ê°™ë‹¤.

### **@CrossOrgin() ì–´ë…¸í…Œì´ì…˜ ì‚¬ìš©**

í•´ë‹¹ ì–´ë…¸í…Œì´ì…˜ì„ í´ëž˜ìŠ¤ë‚˜ ë©”ì†Œë“œì— ë¶™ì´ë©´ í•´ë‹¹ í´ëž˜ìŠ¤ì™€ ë©”ì†Œë“œëŠ” `CORS`ë¥¼ í—ˆìš©í•œë‹¤.

### Spring Security ì—ì„œ CORS ì„¤ì •

`Spring security`ë¥¼ ì‚¬ìš©í•˜ë©´ ëª¨ë“  ì™¸ë¶€ ìš”ì²­ì— ëŒ€í•´ `CORS`ë¥¼ `Block`í•œë‹¤ ë”°ë¼ì„œ `CORS`ì— ëŒ€í•œ ì„¤ì •ì„ ì»¤ìŠ¤í…€í•´ì•¼í•œë‹¤.  `SecurityFilterChain`ì„ ìŠ¤í”„ë§ ë¹ˆìœ¼ë¡œ ë“±ë¡í• ë•Œ `CORS`ì™€ ê´€ë ¨ëœ ì„¤ì •ì„ í•  ìˆ˜ ìžˆë‹¤.

```java

//spring boot 3ì ëŒ€ 
public class SecurityConfig {

    @Bean
    public SecurityFilterChain securityFilterChain(HttpSecurity httpSecurity) throws Exception {
        httpSecurity.cors(corsCustomizer -> corsCustomizer.configurationSource(request -> {
            CorsConfiguration config = new CorsConfiguration();
            config.setAllowedOrigins(Arrays.asList(
                    "http://localhost:3000",
                    "etc.."
            ));
            config.setAllowedMethods(Collections.singletonList("*"));
            config.setAllowCredentials(true);
            config.setAllowedHeaders(Collections.singletonList("*"));
            config.setMaxAge(3600L);
            return config;
        }));
}
```